/*!
  Clerk (c) 2012 Michael Phan-Ba
  https://github.com/mikepb/clerk
  Apache License
*/(function(a,b,c,d){function m(a){var b,c;return a&&(c=/^(https?:\/\/)(?:([^@:]+):([^@]+)@)?(.*?)\/*$/.exec(a),c&&(a=a[1]+a[4])),b=new x(a),a&&(b.auth={user:c[2]&&d(c[2]),pass:c[3]&&d(c[3])}),b}function n(){var a=this,b=l.call(arguments),c=w(b[b.length-1])&&b.pop();return o(b[0]||f,a.uri+(b[1]?"/"+b[1]:""),b[2],b[3]&&JSON.stringify(b[3])||"",b[4],a.auth||{},c),this}function o(a,b,c,d,e,f,h){var i=new XMLHttpRequest,j;i.open(a,b,!0,f.user,f.pass);if(e)for(j in e)i.setRequestHeader(j,e[j]);i.onreadystatechange=function(){if(h&&i.readyState===4){var b=r(i),c=i.responseText,d;if(a===g)c=b;else{try{c=JSON.parse(c)}catch(e){d=e}d||(c=p(c))}h(d,c,i.status,b,i)}},i.send(d)}function p(a){var b=a.rows||a.results||a.uuids;return b?a=s(b,a):(a.id&&(a._id=a.id),a.rev&&(a._rev=a.rev)),a}function r(a){var b={},c,d;for(d=0;c=q[d];d++)b[c]=a.getResponseHeader(c);return b}function s(a){var b=l.call(arguments,1),c,d,e=0,f=b.length;while(e<f){c=b[e++];for(d in c)a[d]=c[d]}return a}function t(a){return Object.prototype.toString.call(a)}function u(a){return t(a)==="[object String]"}function v(a){return t(a)==="[object Object]"}function w(a){return t(a)==="[object Function]"}function x(a){this.uri=a||"http://127.0.0.1:5984"}function y(a,b){this.client=a,this.name=b,this.uri=a.uri+"/"+c(b)}function z(a,b){return a&&(a.key&&(a.key=JSON.stringify(a.key)),a.startkey&&(a.startkey=JSON.stringify(a.startkey)),a.endkey&&(a.endkey=JSON.stringify(a.endkey)),a.stale&&a.stale!=="update_after"&&(a.stale="ok"),a.keys&&(b||(b={}),b.keys=a.keys,delete a.keys)),b}var e=a.exports||{},f="GET",g="HEAD",h="POST",i="PUT",j="DELETE",k="COPY",l=[].slice;a.exports=e=function(a){if(!a||u(a))return m(a);var b=[],c,d=0,e;for(c in a)a[c]=m(a[c]),b.push(c);return e=b.length,function(c){var f;c||(c=b[d++],d%=e);if(!(f=a[c]))throw new Error("no server configured");return f}},e.version="0.1.0pre",e.noConflict=function(){return window.clerk=e._,e};var q=["cache-control","content-length","content-type","date","etag","server"];x.prototype={request:n,database:function(a){var b=new y(this,a);return b.auth=this.auth,b},databases:function(){return this._(arguments)(f,"_all_dbs")},uuids:function(a){var b=this._(arguments,1);return a>1&&(b.q.count=a),b(f,"_uuids")},info:function(){return this._(arguments)(f)},stats:function(){return this._(arguments)(f,"_stats")},log:function(){return this._(arguments)(f,"_log")},tasks:function(){return this._(arguments)(f,"_active_tasks")},config:function(){var a=this._(arguments);return a(f,"_config"+(a.p?"/"+b(a.p):""))},setConfig:function(a,b,d){return this._(arguments,3)(i,["_config",c(a),c(b)].join("/"))},delConfig:function(a,b){return this._(arguments,2)(j,["_config",c(a),c(b)].join("/"))},replicate:function(a){return this._(arguments)(h,"_replicate",{b:a})},restart:function(){return this._(arguments)(h,"_restart")},_:function(a,b){function d(a,b,e){return e||(e={}),c.request(a,b||d.p,e.q||d.q,e.b,e.h||d.h,e.f||d.f),c}var c=this;return a=l.call(a,b),d.f=w(a[a.length-1])&&a.pop(),d.p=u(a[0])&&a.shift(),d.q=a[0]||{},d.h=a[1]||{},d}},y.prototype={request:n,create:function(){return this._(arguments)(i)},destroy:function(){return this._(arguments)(j)},info:function(){return this._(arguments)(f)},exists:function(){var a=this._(arguments),b=a.f;return a.f=function(a,c,d,e,f){b(a,d===200,e,e,f)},a(g)},get:function(){return this._(arguments)(f)},head:function(){var a=this._(arguments),b=a.f;return a.f=function(c,d,e,f,g){b(c,c?d:{id:a.p,rev:f.etag&&JSON.parse(f.etag),contentType:f["content-type"],contentLength:f["content-length"]},e,f,g)},a(g)},put:function(){var a=this._(arguments,0,1);a.p||(a.p=a.b._id),a.q.rev&&(a.b._rev=a.q.rev,delete a.q.rev);if(!a.p)throw new Error("missing id");return a(i)},post:function(a){return this._(arguments,1)(h,0,{b:a})},del:function(a,b){if(!a||!b)throw new Error("missing id or rev");return this._(arguments)(j)},copy:function(a,b){var d=this._(arguments,2),e=c(a.id||a._id),f=c(b.id||b._id),g=a.rev||a._rev,h=b.rev||b._rev;return g&&(d.q.rev=g),h&&(f+="?rev="+c(h)),d.h.Destination=f,d(k,e)},all:function(){var a=this._(arguments),b=z(a.q);return a(b?h:f,"_all_docs",{b:b})},bulk:function(a){var b=this._(arguments,1);return b.q.docs=a,b(h,"_bulk_docs",{q:0,b:b.q})},delAll:function(a,b,c,d){var e=0,f=a.length,g;while(e<f)if(g=a[e++])g._deleted=!0;this.bulk(a,b,c,d)},view:function(a){var b=this._(arguments,1),d,e;return u(a)?(d=a.split("/",2),d=["_design",c(d[0]),"_view",c(d[1])].join("/")):(d="_temp_view",e=a),e=z(b.q,e),b(e?h:f,d,{b:e})},update:function(a){var b=this._(arguments,1,1),d=a.split("/",2);return d=["_design",c(d[0]),"_update",c(d[1])],b.p&&d.push(b.p),d=d.join("/"),b(b.p?i:h,d,{q:b.b,b:b.q})},replicate:function(a,b,c){return a.source||(a.source=this.name),a.target||(a.target=this.name),this.client.replicate(a,b,c)},commit:function(){return this._(arguments)(h,"_ensure_full_commit")},purge:function(a){return this._(arguments,1)(h,"_purge",{b:a})},compact:function(){var a=this._(arguments);return a(h,"_compact"+(a.p?"/"+c(a.p):""))},vacuum:function(){return this._(arguments)(h,"_view_cleanup")},_:function(a,c,d){function e(a,b,c){return c||(c={}),f.request(a,b||e.p,c.q||e.q,c.b||e.b,c.h||e.h,c.f||e.f),f}a=l.call(a,c),e.f=w(a[a.length-1])&&a.pop(),e.p=u(a[0])&&b(a.shift());var f=this,g=u(a[0])&&b(a.shift());return e.q=a[d?1:0]||{},g&&(e.q.rev=g),e.h=a[d?2:1]||{},e.b=d&&a[0],e}},typeof window!="undefined"&&(e._=window.clerk,window.clerk=e)})(typeof module!="undefined"?module:{},encodeURI,encodeURIComponent,decodeURIComponent);