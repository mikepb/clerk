/*!
  Clerk (c) 2012 Michael Phan-Ba
  https://github.com/mikepb/clerk
  Apache License
*/(function(a,b,c,d){function m(a,b,c,d,e){var g=this,h=arguments,i=h.length,j=g.uri+(i<3?"":"/"+b),k=g.auth||{},l=i<5?"":JSON.stringify(d),m=h[i-1],o;i<6&&(e=0),i<4&&(c={}),n(a||f,j,c,l,e,k,m)}function n(a,b,c,d,e,f,h){var i=new XMLHttpRequest,j;i.open(a,b,!0,f.user,f.pass);if(e)for(j in e)i.setRequestHeader(j,e[j]);i.onreadystatechange=function(){if(i.readyState===4){var b=q(i),c=i.responseText;if(a===g)c=b;else try{c=p(JSON.parse(c))}catch(d){err=d}h&&h(null,c,i.status,b,i)}},i.send(d)}function p(a){var b=a.rows||a.results||a.uuids;return b?a=r(b,a):(a.id&&(a._id=a.id),a.rev&&(a._rev=a.rev)),a}function q(a){var b={},c,d;for(d=0;c=o[d];d++)b[c]=a.getResponseHeader(c);return b}function r(a){var b=l.call(arguments,1),c,d;for(d=0;source=b[d];d++)for(c in source)a[c]=source[c]}function s(a){return Object.prototype.toString.call(a)}function t(a){return s(a)==="[object String]"}function u(a){return s(a)==="[object Object]"}function v(a){return s(a)==="[object Function]"}function w(a,b){return a=l.call(a),a.f=v(a[a.length-1])&&a.pop(),a.q=u(a[a.length-1])&&(!b||u(a[a.length-2]))&&a.pop()||{},a}function x(a){this.uri=a||"http://127.0.0.1:5984"}function y(a,b){this.client=a,this.name=b,this.uri=a.uri+"/"+c(b)}function z(a,c){return a=l.call(a),{f:v(a[a.length-1])&&a.pop(),id:s(a[0])&&b(a.shift()),rev:s(a[0])&&a.shift(),q:a[c?1:0],doc:c&&a[0]}}function A(a,b){return a&&(a.key&&(a.key=JSON.stringify(a.key)),a.startkey&&(a.startkey=JSON.stringify(a.startkey)),a.endkey&&(a.endkey=JSON.stringify(a.endkey)),a.stale&&a.stale!=="update_after"&&(a.stale="ok"),a.keys&&(b||(b={}),b.keys=a.keys,delete a.keys)),b}var e=a.exports||{},f="GET",g="HEAD",h="POST",i="PUT",j="DELETE",k="COPY",l=Array.prototype.slice;a.exports=e=function(a){var b,c;return a&&(c=/^(https?:\/\/)(?:([^@:]+):([^@]+)@)?(.*?)\/*$/.exec(a),c&&(a=a[1]+a[4])),b=new x(a),a&&(b.auth={user:c[2]&&d(c[2]),pass:c[3]&&d(c[3])}),b},e.version="0.1.0pre",e.noConflict=function(){return window.clerk=e._,e};var o=["Cache-Control","Content-Length","Content-Type","Date","ETag","Server"];x.prototype={request:m,database:function(a){var b=new y(this.uri+"/"+c(a));return b.auth=this.auth,b},databases:function(){var a=w(arguments);this.request(f,"_all_dbs",a.q,a.f)},uuids:function(a){var b=w(arguments);a>1&&(b.q.count=a),this.request(f,"_uuids",b.q,b.f)},info:function(){var a=w(arguments);this.request(f,"",a.q,a.f)},stats:function(){var a=w(arguments);this.request(f,"_stats",a.q,a.f)},log:function(){var a=w(arguments);this.request(f,"_log",a.q,a.f)},tasks:function(){var a=w(arguments);this.request(f,"_active_tasks",a.q,a.f)},config:function(){var a=w(arguments),c="_config";a[0]&&(c+=b(a[0])),this.request(f,c,a.q,a.f)},setConfig:function(a,b,d){var e=w(arguments,1),f=["_config",c(a),c(b)].join("/");this.request(i,f,e.q,d,e.f)},delConfig:function(a,b){var d=w(arguments),e=["_config",c(a),c(b)].join("/");this.request(j,e,d.q,d.f)},replicate:function(a){var b=w(arguments,1);this.request(h,"_replicate",b.q,a,b.f)},restart:function(){var a=w(arguments);this.request(h,"_restart",a.q,"",a.f)}},x=x,y.prototype={request:m,create:function(){var a=w(arguments);this.request(i,"",a.q,"",a.f)},destroy:function(){var a=w(arguments);this.request(j,"",a.q,"",a.f)},info:function(){var a=w(arguments);this.request(f,"",a.q,a.f)},exists:function(){var a=w(arguments);this.request(g,"",a.q,function(b,c,d,e,f){a.f&&a.f(b,d===200,e,e,f)})},get:function(){var a=z(arguments);this.request(f,a.id,a.q,a.f)},head:function(a){var b=w(arguments);this.request(g,c(a),b.q,function(c,d,e,f,g){b.f&&b.f(c,c?d:{id:a,rev:f.etag&&JSON.parse(f.etag),contentType:f["content-type"],contentLength:f["content-length"]},e,f,g)})},put:function(){var a=z(arguments,1);this.request(i,a.id,a.q,a.doc,a.f)},post:function(){var a=z(arguments,1);this.request(h,"",a.q,a.doc,a.f)},del:function(a,b,c,d){var e=z(arguments);this.request(j,e.id,e.rev,"",e.f)},copy:function(a,b,d,e){var f=c(a.id||a._id),g=c(b.id||b._id),h=a.rev||a._rev,i=b.rev||b._rev;v(d)&&(e=options,d={}),h&&(d.rev=h),i&&(g+="?rev="+c(i)),this.request(k,f,d,"",{Destination:g},e)},all:function(a,b){var c;v(a)?b=a:c=A(a),this.request(c?h:f,"_all_docs",a,c,b)},bulk:function(a){var b=w(arguments);b.q.docs=a,this.request(h,"_bulk_docs",0,b.q,b.f)},delAll:function(a,b,c){var d=0,e;while(e=a[d++])e._deleted=!0;this.bulk(a,b,c)},view:function(a){var b=w(arguments),d;a?(path=a.split("/",2),path=["_design",c(path[0]),"_view",c(path[1])].join("/")):(path="_temp_view",d=a),d=A(query,d),this.request(d?h:f,path,b.q,d,b.f)},update:function(a){var b=l.call(arguments,1),d=v(b[b.length-1])&&b.pop(),e=t(e)&&b.shift(),f=b[0],g=b[1],j=b[2],k=a.split("/",2);k=["_design",c(k[0]),"_update",c(k[1])],e&&k.push(e),k=k.join("/"),this.request(e?i:h,k,f,g,j,d)},replicate:function(a,b,c){a.source||(a.source=this.name),a.target||(a.target=this.name),this.client.replicate(a,b,c)},commit:function(){var a=w(arguments);this.request(h,"_ensure_full_commit",a.q,"",a.f)},purge:function(a){var b=w(arguments);this.request(h,"_purge",b.q,a,b.f)},compact:function(){var a=w(arguments),b="_compact";a[0]&&(b+="/"+c(design)),this.request(h,b,a.q,"",a.f)},vacuum:function(a){this.request(h,"_view_cleanup",0,"",a)}},y=y,typeof window!="undefined"&&(e._=window.clerk,window.clerk=e)})(typeof module!="undefined"?module:{},encodeURI,encodeURIComponent,decodeURIComponent);