/*!
  Clerk (c) 2012 Michael Phan-Ba
  https://github.com/mikepb/clerk
  Apache License
*/(function(a,b,c,d){function l(a,b,c,d,f){var g=this,h=arguments,i=h.length,j=g.uri+(i<3?"":"/"+b),k=g.auth||{},l=i<5?"":JSON.stringify(d),n=h[i-1],o;a||(a=e),i<6&&(f=0),i<4&&(c={}),m(a,j,c,l,f,k,n)}function m(a,b,c,d,e,g,h){var i=new XMLHttpRequest;i.open(a,b,!0,g.user,g.pass);if(e)for(header in e)i.setRequestHeader(header,e[header]);i.onreadystatechange=function(){if(i.readyState===4){var b=p(i),c=i.responseText;if(a===f)c=b;else try{c=o(JSON.parse(c))}catch(d){err=d}h&&h(null,c,i.status,b,i)}},i.send(d)}function o(a){var b=a.rows||a.results||a.uuids;return b?a=q(b,a):(a.id&&(a._id=a.id),a.rev&&(a._rev=a.rev)),a}function p(a){var b={},c,d;for(d=0;c=n[d];d++)b[c]=a.getResponseHeader(c);return b}function q(a){var b=k.call(arguments,1),c,b,d;for(c=0;source=b[c];c++)for(d in source)a[d]=source[d]}function r(a){return Object.prototype.toString.call(a)}function s(a){return r(a)==="[object String]"}function t(a){return r(a)==="[object Object]"}function u(a){return r(a)==="[object Function]"}function v(a,b){return a=k.call(a),a.f=u(a[a.length-1])&&a.pop(),a.q=t(a[a.length-1])&&(!b||t(a[a.length-2]))&&a.pop()||{},a}function w(a){this.uri=a}function x(a,b){this.client=a,this.name=b,this.uri=a.uri+"/"+c(b)}function y(a,c){return a=k.call(a),{f:u(a[a.length-1])&&a.pop(),id:r(a[0])&&b(a.shift()),rev:r(a[0])&&a.shift(),q:a[c?1:0],doc:c&&a[0]}}function z(a,b){return a&&(a.key&&(a.key=JSON.stringify(a.key)),a.startkey&&(a.startkey=JSON.stringify(a.startkey)),a.endkey&&(a.endkey=JSON.stringify(a.endkey)),a.stale&&a.stale!=="update_after"&&(a.stale="ok"),a.keys&&(b||(b={}),b.keys=a.keys,delete a.keys)),b}var e="GET",f="HEAD",g="POST",h="PUT",i="DELETE",j="COPY",k=Array.prototype.slice;a.version="0.1.0pre",a.noConflict=function(){return window.clerk=a._,a},a.createClient=function(a){var b=/^(https?:\/\/)(?:([^@:]+):([^@]+)@)?(.*?)\/*$/.exec(a);if(!b)throw new Error("Bad URI: "+a);var c=new w(b[1]+b[4]);return c.auth={user:b[2]&&d(b[2]),pass:b[3]&&d(b[3])},c};var n=["Cache-Control","Content-Length","Content-Type","Date","ETag","Server"];w.prototype={request:l,database:function(a){var b=new x(this.uri+"/"+c(a));return b.auth=this.auth,b},databases:function(){var a=v(arguments);this.request(e,"_all_dbs",a.q,a.f)},uuids:function(a){var b=v(arguments);a>1&&(b.q.count=a),this.request(e,"_uuids",b.q,b.fn)},info:function(){var a=v(arguments);this.request(e,"",a.q,a.f)},stats:function(){var a=v(arguments);this.request(e,"_stats",a.q,a.f)},log:function(){var a=v(arguments);this.request(e,"_log",a.q,a.f)},tasks:function(){var a=v(arguments);this.request(e,"_active_tasks",a.q,a.f)},config:function(){var a=v(arguments),c="_config";a[0]&&(c+=b(a[0])),this.request(e,c,a.q,a.f)},setConfig:function(a,b,d){var e=v(arguments,1),f=["_config",c(a),c(b)].join("/");this.request(h,f,e.q,d,e.f)},delConfig:function(a,b){var d=v(arguments),e=["_config",c(a),c(b)].join("/");this.request(i,e,d.q,d.f)},replicate:function(a){var b=v(arguments,1);this.request(g,"_replicate",b.q,a,b.f)},restart:function(){var a=v(arguments);this.request(g,"_restart",a.q,"",a.f)}},x.prototype={request:l,create:function(){var a=v(arguments);this.request(h,"",a.q,"",a.f)},destroy:function(){var a=v(arguments);this.request(i,"",a.q,"",a.f)},info:function(){var a=v(arguments);this.request(e,"",a.q,a.f)},exists:function(){var a=v(arguments);this.request(f,"",a.q,function(b,c,d,e,f){a.f&&a.f(b,d===200,e,e,f)})},get:function(){var a=y(arguments);this.request(e,a.id,a.q,a.f)},head:function(a){var b=v(arguments);this.request(f,c(a),b.q,function(c,d,e,f,g){b.f&&b.f(c,c?d:{id:a,rev:f.etag&&JSON.parse(f.etag),contentType:f["content-type"],contentLength:f["content-length"]},e,f,g)})},put:function(){var a=y(arguments,1);this.request(h,a.id,a.q,a.doc,a.f)},post:function(){var a=y(arguments,1);this.request(g,"",a.q,a.doc,a.f)},del:function(a,b,c,d){var e=y(arguments);this.request(i,e.id,e.rev,"",e.f)},copy:function(a,b,d,e){var f=c(a.id||a._id),g=c(b.id||b._id),h=a.rev||a._rev,i=b.rev||b._rev;u(d)&&(e=options,d={}),h&&(d.rev=h),i&&(g+="?rev="+c(i)),this.request(j,f,d,"",{Destination:g},e)},all:function(a,b){var c;u(a)?b=a:c=z(a),this.request(c?g:e,"_all_docs",a,c,b)},bulk:function(a){var b=v(arguments);b.q.docs=a,this.request(g,"_bulk_docs",0,b.q,b.f)},delAll:function(a,b,c){var d=0,e;while(e=a[d++])e._deleted=!0;this.bulk(a,b,c)},view:function(a){var b=v(arguments),a=b[0],d;a?(path=a.split("/",2),path=["_design",c(path[0]),"_view",c(path[1])].join("/")):(path="_temp_view",d=a),d=z(query,d),this.request(d?g:e,path,b.q,d,b.f)},update:function(a){var b=k.call(arguments,1),d=u(b[b.length-1])&&b.pop(),e=s(e)&&b.shift(),f=b[0],i=b[1],j=b[2],l=a.split("/",2);l=["_design",c(l[0]),"_update",c(l[1])],e&&l.push(e),l=l.join("/"),this.request(e?h:g,l,f,i,j,d)},replicate:function(a,b,c){a.source||(a.source=this.name),a.target||(a.target=this.name),this.client.replicate(a,b,c)},commit:function(){var a=v(arguments);this.request(g,"_ensure_full_commit",a.q,"",a.f)},purge:function(a){var b=v(arguments);this.request(g,"_purge",b.q,a,b.fn)},compact:function(){var a=v(arguments),b="_compact";a[0]&&(b+="/"+c(design)),this.request(g,b,a.q,"",a.f)},vacuum:function(a){this.request(g,"_view_cleanup",0,"",a)}},typeof window!="undefined"&&(a._=window.clerk,window.clerk=a)})(typeof exports!="undefined"?exports:{},encodeURI,encodeURIComponent,decodeURIComponent);